# テストシナリオ

*このドキュメントはTRIR仕様から自動生成されました*

# テストシナリオ一覧

| ID | タイトル | 対象機能 | 検証要件 | 期待結果 |
|----|---------|---------|---------|---------|
| CLR-001 | 金額完全一致で自動消込成功 | execute_clearing | REQ-CLR-001 | 成功 |
| CLR-002 | 部分入金で残高が減少 | execute_clearing | REQ-CLR-001 | 成功 |
| CLR-003 | 過剰消込はエラー | execute_clearing | REQ-CLR-001 | エラー: OVER_CLEARING |
| CLR-004 | 消込取消で残高復元 | reverse_clearing | REQ-CLR-003 | 成功 |

---

## シナリオ詳細

### CLR-001: 金額完全一致で自動消込成功

**初期状態**:

- customer: 1件
- ar_invoice: 1件
- ar_receipt: 1件
- ar_clearing: 0件

**実行**: `execute_clearing`

入力:
- receipt_id: `RCP-001`
- invoice_id: `INV-001`
- amount: `110000`
- match_score: `90`
- match_reasons: `['AMOUNT_EXACT_MATCH', 'CUSTOMER_MATCH']`
- clear_type: `AUTO`

**期待結果**:

- 成功

### CLR-002: 部分入金で残高が減少

**初期状態**:

- customer: 1件
- ar_invoice: 1件
- ar_receipt: 1件
- ar_clearing: 0件

**実行**: `execute_clearing`

入力:
- receipt_id: `RCP-001`
- invoice_id: `INV-001`
- amount: `50000`
- match_score: `60`
- match_reasons: `['CUSTOMER_MATCH', 'FIFO_APPLIED']`
- clear_type: `PARTIAL`

**期待結果**:

- 成功

### CLR-003: 過剰消込はエラー

**初期状態**:

- customer: 1件
- ar_invoice: 1件
- ar_receipt: 1件
- ar_clearing: 0件

**実行**: `execute_clearing`

入力:
- receipt_id: `RCP-001`
- invoice_id: `INV-001`
- amount: `120000`
- match_score: `70`
- match_reasons: `['CUSTOMER_MATCH']`
- clear_type: `MANUAL`

**期待結果**:

- エラー: `OVER_CLEARING`

### CLR-004: 消込取消で残高復元

**初期状態**:

- customer: 1件
- ar_invoice: 1件
- ar_receipt: 1件
- ar_clearing: 1件

**実行**: `reverse_clearing`

入力:
- clearing_id: `CLR-001`
- reason: `誤消込のため取消`

**期待結果**:

- 成功

