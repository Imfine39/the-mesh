{
  "function": "addToCart",
  "function_def": {
    "description": "商品をカートに追加",
    "entity": "Cart",
    "input": {
      "cartId": {
        "type": "string",
        "required": true
      },
      "productId": {
        "type": "string",
        "required": true
      },
      "quantity": {
        "type": "int",
        "required": true,
        "min": 1
      }
    },
    "output": {
      "cartItem": {
        "type": "CartItem"
      }
    },
    "pre": [
      {
        "expr": {
          "type": "binary",
          "op": "gt",
          "left": {
            "type": "input",
            "field": "quantity"
          },
          "right": {
            "type": "literal",
            "value": 0
          }
        },
        "reason": "数量は1以上を指定してください"
      }
    ],
    "post": [
      {
        "action": {
          "create": {
            "target": "CartItem",
            "data": {
              "id": {
                "type": "call",
                "function": "generateId"
              },
              "cartId": {
                "type": "input",
                "field": "cartId"
              },
              "productId": {
                "type": "input",
                "field": "productId"
              },
              "quantity": {
                "type": "input",
                "field": "quantity"
              },
              "unitPrice": {
                "type": "ref",
                "path": "product.price"
              }
            }
          }
        }
      },
      {
        "action": {
          "update": {
            "target": "Product",
            "id": {
              "type": "input",
              "field": "productId"
            },
            "set": {
              "stock": {
                "type": "binary",
                "op": "sub",
                "left": {
                  "type": "self",
                  "field": "stock"
                },
                "right": {
                  "type": "input",
                  "field": "quantity"
                }
              }
            }
          }
        }
      }
    ]
  },
  "entities": {},
  "derived": {},
  "scenarios": {},
  "invariants": []
}