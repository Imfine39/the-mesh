# 仕様の正と検証の関係（整理メモ）

## 目的

* これまでの議論を「破綻しないワークフロー設計」に向けて再整理する。
* 既存ドキュメントを正として盲信せず、運用で破綻しない構造を言語化する。

---

## 1. 前提（仮説として扱う）

* 仕様の「正（Source of truth）」が複数あると破綻しやすい。
* 仕様の正は「共有境界（API/DB）」に置いた方が破綻しにくい。
* ATは「正そのもの」ではなく「正しさを検証する手段」とみなす。

---

## 2. モデル整理（関数・状態・検証）

### 2.1 関数モデル（概念）

* **契約（API/DBのスキーマや互換性ルール）= 関数の定義**
* **DB = 関数が参照・更新する状態（State）**
* **AT = 関数 + 状態の結果が業務要件と一致するかの検証**

> DB は関数そのものではなく「状態」。
> AT は「正」ではなく「正しさの検証」。

---

## 3. 「正の仕様」の配置

### 3.1 正の仕様はどこに置くべきか

* **正の仕様 = API/DB 契約（共有境界）**
* 理由: 複数ATや複数機能が依存するため、ここが崩れると全体が崩れる。

### 3.2 ATはどこに置くべきか

* ATは「契約に従った結果が業務要件に一致するか」を検証する。
* **ATは正を上書きするものではない**。

---

## 4. 要件定義の流れ（破綻しない整理）

### 4.1 要件定義で定める中身

* 業務要件（REQ）を、最終的に **契約（API/DB）に反映できる形**に落とす。
* ただし「正の仕様」は API/DB 契約で固定する。

### 4.2 要件決定の順序（直感とのギャップ）

* 実務では **ATの検討が先行することが多い**。
* しかし **正の仕様は API/DB 契約に固定**するため、
  * AT → 契約変更 ではなく、
  * AT → 契約の整合検証（差分チェック）
  の流れを明示する。

> つまり「ATが先に作られることはあっても、正は契約側に置く」。
> ここを守ることで「ATが契約を壊す」破綻を避ける。

---

## 5. 破綻しないための運用ポイント

1. **契約変更は集約管理（RFCなど）**
   * AT単独で契約を動かさない。
2. **REQ → AT トレーサビリティ**
   * 業務要件がATで検証される構造を維持する。
3. **ATは「検証」であり「正」ではない**
   * ATが契約に反する場合はATの方を修正対象とみなす。

---

## 6. ここから深掘りする論点

* 「契約＝正」を前提にしたときの **要件定義テンプレート**
* ATと契約の **差分検証フロー（CIゲート）**
* DB状態の「正しさ」をどう定義するか（整合性・履歴性・参照性）

---

## まとめ

* **正の仕様は API/DB 契約に固定**し、ATは検証に徹する。
* DBは関数ではなく「状態」と捉えると破綻しにくい。
* 要件定義では AT を先に検討してもよいが、正は契約側に固定する。
